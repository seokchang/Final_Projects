<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="customer">
	<select id="mypage" parameterType="_int" resultType="u">
		select
			user_no as userNo,
			user_id as userId,
			user_pw as userPw,
			user_name as userName,
			user_phone as userPhone,
			user_level as userLevel,
			user_birth as userBirth,
			user_date as userDate,
			user_gender as userGender,
			user_addr as userAddr,
			user_point as userPoint
		from user_tbl where user_no=#{parameter}
	</select>
	<update id="updateCustomer" parameterType="u">
		update user_tbl set
			user_pw=#{userPw},
			user_phone=#{userPhone},
			user_addr=#{userAddr}
		where user_no=#{userNo}	
	</update>
	<select id="reserveInfo" parameterType="_int" resultType="r">
		select 
			R.res_no as resNo,
			R.user_no as userNo,
			R.camp_no as campNo,
			C.camp_name as campName,
			R.camp_room as campRoomNo,
			CR.room_name as campRoomName,
			C.camp_addr as campAddr,
			R.res_in_time as resInTime,
			R.res_out_time as resOutTime,
			R.res_in_date as resInDate,
			R.res_out_date as resOutDate,
			R.res_member as resMember,
			R.res_price as resPrice,
			R.res_memo as resMemo,
			R.res_count as resCount
		from reservation R inner join camp C on R.camp_no=C.camp_no
				inner join camproom CR on R.camp_room=CR.room_no
		 where user_no=#{parameter} and res_out_date >= to_char(sysdate,'yyyy-mm-dd')
	</select>
	<select id="useInfo" parameterType="map" resultType="r">
		select * from 
		(select rownum as rnum, n. * from 
			(select 
				R.res_no as resNo,
				R.user_no as userNo,
				R.camp_no as campNo,
				C.camp_name as campName,
				R.camp_room as campRoomNo,
				CR.room_name as campRoomName,
				C.camp_addr as campAddr,
				R.res_in_time as resInTime,
				R.res_out_time as resOutTime,
				R.res_in_date as resInDate,
				R.res_out_date as resOutDate,
				R.res_member as resMember,
				R.res_price as resPrice,
				R.res_memo as resMemo,
				R.res_count as resCount
			from reservation R inner join camp C on R.camp_no=C.camp_no
					inner join camproom CR on R.camp_room=CR.room_no 
			where R.user_no=#{userNo}
			order by 1 desc)
		n)
		where rnum between #{start} and #{end}
	</select>
	<select id="totalUse" parameterType="_int" resultType="r">
		select 
				R.res_no as resNo,
				R.user_no as userNo,
				R.camp_no as campNo,
				C.camp_name as campName,
				R.camp_room as campRoomNo,
				CR.room_name as campRoomName,
				C.camp_addr as campAddr,
				R.res_in_time as resInTime,
				R.res_out_time as resOutTime,
				R.res_in_date as resInDate,
				R.res_out_date as resOutDate,
				R.res_member as resMember,
				R.res_price as resPrice,
				R.res_memo as resMemo,
				R.res_count as resCount
			from reservation R inner join camp C on R.camp_no=C.camp_no
					inner join camproom CR on R.camp_room=CR.room_no
		where user_no=#{parameter}
	</select>
	<select id="reviewInfo" parameterType="map" resultType="rv">
		select * from 
		(select rownum as rnum, n. * from(select
					R.rev_no as revNo,
					R.user_id as userId,
					R.camp_no as campNo,
					C.camp_name as campName,
					R.rev_contents as revContents,
					R.rev_star as revStar,
					R.rev_date as revDate,
					R.rev_image as revImage,
					R.rev_heart as revHeard
				from review R inner join camp C on R.camp_no=C.camp_no
				where user_id=#{userId} order by 1 desc)n)
		 where rnum between #{start} and #{end}
	</select>
	<select id="totalReview" parameterType="string" resultType="rv">
		select
			R.rev_no as revNo,
			R.user_id as userId,
			R.camp_no as campNo,
			C.camp_name as campName,
			R.rev_contents as revContents,
			R.rev_star as revStar,
			R.rev_date as revDate,
			R.rev_image as revImage,
			R.rev_heart as revHeard
		from review R inner join camp C on R.camp_no=C.camp_no
		where user_id=#{parameter}
	</select>
	<select id="pointInfo" parameterType="_int" resultType="p">
		select 
			point_no as pointNo,
			user_no as userNo,
			point_save_contents as pointSaveContents,
			point_save_date as pointSaveDate,
			point_save as pointSave,
			point_total as pointTotal,
			point_use as pointUse,
			point_use_contents as pointUseContents,
			point_use_date as pointUseDate
		from point where user_no=#{parameter}
	</select>
</mapper>
